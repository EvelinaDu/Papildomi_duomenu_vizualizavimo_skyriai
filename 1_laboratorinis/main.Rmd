# Bibliotekos

```{r message=FALSE, warning=FALSE}
library(tidyverse)
```

# Duomenų paruošimas

```{r}

data <- read.csv("loan_data.csv")
data <- data %>%
  mutate(across(c(credit.policy, not.fully.paid, purpose), as.factor))

data <- data %>% 
  mutate(annual.inc = exp(log.annual.inc))

nrow(data)
length(data)

data %>%
  summarise(across(everything(), ~ sum(is.na(.))))
```

```{r}
set.seed(2026)
sampled_data <- data %>%
  group_by(purpose) %>%
  slice_sample(n = 500) %>%
  ungroup()
```

```{r}
nrow(sampled_data)
head(sampled_data)
summary(sampled_data)
str(sampled_data)
```

## Išskirtys

```{r}
count_outliers <- function(data, var_name) {
  data %>%
    summarise(
      variable = var_name,
      Q1 = quantile(.data[[var_name]], 0.25),
      Q3 = quantile(.data[[var_name]], 0.75),
      H = Q3 - Q1,
      inner_low = Q1 - 1.5*H,
      inner_high = Q3 + 1.5*H,
      outer_low = Q1 - 3*H,
      outer_high = Q3 + 3*H,
      mild_outliers = sum(.data[[var_name]] < inner_low | .data[[var_name]] > inner_high),
      extreme_outliers = sum(.data[[var_name]] < outer_low | .data[[var_name]] > outer_high)
      ) %>% 
    select(-c(inner_low, inner_high, outer_low, outer_high))
}
```

```{r}
numeric_cols <- sampled_data %>% 
  select(where(is.numeric)) %>% 
  names()

results_list <- lapply(numeric_cols, function(col) count_outliers(sampled_data, col))
outlier_summary <- bind_rows(results_list)
outlier_summary
```

```{r}
results_list <- lapply(numeric_cols, function(col) count_outliers(data, col))
outlier_summary_full <- bind_rows(results_list)
outlier_summary_full
```

```{r}
sampled_data %>%
  select(where(is.numeric)) %>%
  pivot_longer(everything()) %>%
  ggplot(aes(x = name, y = value, fill = name)) +
  geom_boxplot() +
  facet_wrap(~name, scales = "free") +
  theme_bw() +
  theme(legend.position = "none")
```

```{r}
print(paste("Daugiau nei vienas viešasis įrašas: ", sampled_data %>% select(pub.rec) %>% filter(pub.rec > 1) %>% nrow() ))
print(paste("Bent vienas praleistas mokėjimas: ", sampled_data %>% select(delinq.2yrs) %>% filter(delinq.2yrs > 0) %>% nrow() ))
print(paste("Palūkanos didesnės už 20%: ", sampled_data %>% select(int.rate) %>% filter(int.rate > .2) %>% nrow() ))
print(paste("Metinis uždatbis daugiau nei 1 mln.: ", sampled_data %>% select(annual.inc) %>% filter(annual.inc > 1000000) %>% nrow() ))
print(paste("Nesumokėta suma lygi 0: ", sampled_data %>% select(revol.bal) %>% filter(revol.bal == 0) %>% nrow() ))
```

# Pirminė duomenų analizė

## Skaitinės charakteristikos

```{r}
char_policy <- sampled_data %>% 
  group_by(credit.policy) %>% 
  select("int.rate", "installment", "log.annual.inc", "dti", "fico", "days.with.cr.line",
         "revol.bal", "revol.util", "inq.last.6mths", "delinq.2yrs", "pub.rec") %>% 
  summarise(across(everything(), list(min = min, max = max, 
                                      mean = mean, sd = sd,
                                      median = median, 
                                      q_25 = ~quantile(.x, 0.25),
                                      q_75 = ~quantile(.x, 0.75)))) %>% 
  pivot_longer(cols = -credit.policy)
```

```{r}
char_purpose <- sampled_data %>% 
  group_by(purpose) %>% 
  select("int.rate", "installment", "log.annual.inc", "dti", "fico", "days.with.cr.line",
         "revol.bal", "revol.util", "inq.last.6mths", "delinq.2yrs", "pub.rec") %>% 
  summarise(across(everything(), list(min = min, max = max, 
                                      mean = mean, sd = sd,
                                      median = median, 
                                      q_25 = ~quantile(.x, 0.25),
                                      q_75 = ~quantile(.x, 0.75)))) %>% 
  pivot_longer(cols = -purpose)
```

